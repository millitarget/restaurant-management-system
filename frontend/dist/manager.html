<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Order Manager</title><link rel="stylesheet" href="styles.css"><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><script src="supabase-client.js"></script><style>body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background-color:#f5f5f5;margin:0;padding:0}.container{max-width:1200px;margin:0 auto;padding:20px}.nav-header{color:#fff;padding:15px;border-radius:8px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}.nav-actions{display:flex;align-items:center;gap:20px}.phone-order-btn{background-color:#ff5722;color:#fff;text-decoration:none;padding:8px 15px;border-radius:4px;font-weight:500;transition:background-color .3s}.phone-order-btn:hover{background-color:#e64a19}.manager{background-color:#673ab7}.nav-items{display:flex;justify-content:space-around;margin-bottom:20px}.nav-tab{flex:1;background-color:#f1f1f1;padding:10px 15px;text-align:center;border-radius:4px;margin:0 5px;cursor:pointer;transition:all .3s}.nav-tab.active{background-color:#2196f3;color:#fff}.tab-content{display:none;overflow-y:visible}.tab-content.active{display:block}#order-form{background-color:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.1);margin-bottom:20px}h1,h2,h3{color:#333}.form-group{margin-bottom:15px}label{display:block;margin-bottom:5px;font-weight:500}.form-control{width:100%;padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:16px}.items-container{margin-top:20px}.item-row{display:grid;grid-template-columns:3fr 1fr 1fr 1fr 1fr 80px;gap:10px;margin-bottom:10px;align-items:center}.item-header{font-weight:700;padding:8px 0;border-bottom:2px solid #eee}.btn-add-item{background-color:#4caf50;color:#fff;border:none;border-radius:4px;padding:8px 16px;cursor:pointer;font-size:14px;margin-top:10px}.btn-remove-item{background-color:#f44336;color:#fff;border:none;border-radius:4px;padding:5px 10px;cursor:pointer;font-size:14px}.btn-save{background-color:#2196f3;color:#fff;border:none;border-radius:4px;padding:10px 20px;cursor:pointer;font-size:16px;margin-top:20px}.btn-cancel{background-color:#f44336;color:#fff;border:none;border-radius:4px;padding:10px 20px;cursor:pointer;font-size:16px}.btn-edit{background-color:#ff9800;color:#fff;border:none;border-radius:4px;padding:5px 10px;cursor:pointer;font-size:14px;margin-top:5px}.time-slots-wrapper{display:flex;flex-direction:column;gap:20px}.time-slot{margin-bottom:20px}.time-slot-header{display:none}.orders-list{display:flex;flex-direction:column;gap:8px;background-color:#fff;border-radius:0 0 4px 4px;padding:10px;box-shadow:0 2px 8px rgba(0,0,0,.1)}.order-card{border-left:3px solid #2196f3;background-color:#f9f9f9;padding:10px 12px;border-radius:4px;cursor:pointer;transition:all .3s ease;overflow:hidden;margin-bottom:8px;display:flex;align-items:center}.order-card:hover{background-color:#f0f0f0}.order-time{font-size:1.1rem;font-weight:600;color:var(--primary-color);background-color:#eceff1;padding:4px 8px;border-radius:4px;margin-right:12px;min-width:60px;text-align:center}.order-header{display:flex;justify-content:space-between;align-items:center;flex-grow:1}.order-info{font-weight:500;color:var(--primary-dark)}.order-source{color:var(--text-secondary);font-size:.9rem}.order-status-actions{display:flex;align-items:center;gap:8px}.order-actions{display:flex;gap:5px}.btn-complete,.btn-delete,.btn-edit{padding:4px 8px;border:none;border-radius:4px;font-size:.8rem;cursor:pointer;color:#fff}.btn-edit{background-color:#ff9800}.btn-complete{background-color:#4caf50}.btn-delete{background-color:#f44336}.order-items-list{display:none;margin-top:8px;padding-top:8px;border-top:1px dashed #ddd;font-size:.9rem}.order-card.expanded .order-items-list{display:block}.order-summary{font-size:14px;margin-top:5px;color:#666}.order-details{max-height:0;overflow:hidden;transition:max-height .3s ease,padding .3s ease;padding:0;margin-top:0}.order-card.expanded .order-details{max-height:500px;padding-top:10px;margin-top:10px;border-top:1px solid #eee}.order-status{padding:4px 8px;border-radius:4px;font-size:12px;font-weight:700}.status-pending{background-color:#ffc107;color:#333}.status-in-progress{background-color:#2196f3;color:#fff}.status-done{background-color:#4caf50;color:#fff}.notification{position:fixed;top:20px;right:20px;padding:15px 20px;border-radius:4px;color:#fff;font-weight:700;z-index:1000;animation:fadeIn .3s,fadeOut .3s 2.7s;max-width:300px}.notification-success{background-color:#4caf50}.notification-error{background-color:#f44336}.notification-warning{background-color:#ff9800}.station-modules{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}.station-module{flex:1;min-width:200px;background-color:#fff;border-radius:8px;padding:15px;box-shadow:0 2px 8px rgba(0,0,0,.1);text-align:center;transition:transform .3s,box-shadow .3s}.station-module:hover{transform:translateY(-5px);box-shadow:0 8px 16px rgba(0,0,0,.15)}.station-icon{font-size:36px;margin-bottom:10px;color:#673ab7}.station-title{font-weight:700;margin-bottom:10px;color:#333}.station-description{font-size:14px;color:#666;margin-bottom:15px}.station-link{display:inline-block;background-color:#ff5722;color:#fff;text-decoration:none;padding:8px 15px;border-radius:4px;font-weight:500;transition:background-color .3s;width:100%;box-sizing:border-box}.station-link:hover{background-color:#e64a19}.phone-station{border-top:4px solid #ff5722}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{from{opacity:1}to{opacity:0}}body,html{height:100%;overflow-y:auto!important}body.apple-manager{min-height:100%;overflow-y:auto!important}</style></head><body class="apple-manager apple-design"><div class="container"><div class="nav-header manager"><h1 class="nav-title">Restaurant Manager</h1><div class="nav-actions"><div id="current-time"></div></div></div><div class="nav-items"><div class="nav-tab active" data-tab="create-order">Create Order</div><div class="nav-tab" data-tab="pending-orders">Pending Orders</div><div class="nav-tab" data-tab="completed-orders">Completed Orders</div></div><div id="create-order" class="tab-content active"><form id="order-form"><div class="form-group"><label for="customer-name">Customer Name</label> <input type="text" id="customer-name" class="form-control" required></div><div class="form-group"><label for="order-source">Order Source</label> <select id="order-source" class="form-control" required><option value="">Select Source</option><option value="in-store">In-Store</option><option value="phone">Phone</option><option value="online">Online</option></select></div><div class="form-group"><label for="scheduled-time">Scheduled Time (Leave blank for immediate preparation)</label> <input type="datetime-local" id="scheduled-time" class="form-control"></div><div class="items-container"><h3>Order Items</h3><div class="item-row item-header"><div>Item Name</div><div>Quantity</div><div>Station</div><div>Prep Time (min)</div><div>Status</div><div></div></div><div id="items-list"></div><button type="button" id="add-item" class="btn-add-item">Add Item</button></div><div class="form-actions"><button type="button" id="cancel-order" class="btn-cancel">Cancel</button> <button type="submit" id="save-order" class="btn-save">Save Order</button></div></form></div><div id="pending-orders" class="tab-content"><div class="time-slots-wrapper" id="pending-orders-list"></div></div><div id="completed-orders" class="tab-content"><div class="time-slots-wrapper" id="completed-orders-list"></div></div></div><template id="item-template"><div class="item-row animate-new"><input type="text" class="form-control item-name" placeholder="Item name" required> <input type="number" class="form-control item-quantity" min="1" value="1" required> <select class="form-control item-station" required><option value="">Select Station</option><option value="grill">Grill</option><option value="fries">Fries</option><option value="kitchen">Kitchen</option><option value="assembly">Assembly</option></select> <input type="number" class="form-control item-prep-time" min="1" value="5" required> <select class="form-control item-status"><option value="pending">Pending</option><option value="ready-to-start">Ready to Start</option><option value="in-progress">In Progress</option><option value="done">Done</option></select> <button type="button" class="btn-remove-item">Remove</button></div></template><template id="order-card-template"><div class="order-card"><div class="order-header"><div class="order-info"><span class="order-id"></span> <span class="customer-name"></span> <span class="order-source"></span></div><div class="order-status-actions"><span class="order-status"></span><div class="order-actions"><button class="btn-edit">Edit</button> <button class="btn-complete">Complete</button> <button class="btn-delete">Delete</button></div></div></div><div class="order-items-list"></div></div></template><script>let customerNameInput=document.getElementById("customer-name"),orderSourceSelect=document.getElementById("order-source"),scheduledTimeInput=document.getElementById("scheduled-time"),orderForm=document.getElementById("order-form"),itemsList=document.getElementById("items-list"),addItemButton=document.getElementById("add-item"),saveOrderButton=document.getElementById("save-order"),cancelOrderButton=document.getElementById("cancel-order"),pendingOrdersList=document.getElementById("pending-orders-list"),completedOrdersList=document.getElementById("completed-orders-list"),itemTemplate=document.getElementById("item-template"),orderCardTemplate=document.getElementById("order-card-template"),navTabs=document.querySelectorAll(".nav-tab"),tabContents=document.querySelectorAll(".tab-content"),currentTimeEl=document.getElementById("current-time"),currentOrderId=null;function updateClock(){var e=new Date;currentTimeEl.textContent=e.toLocaleTimeString()}function addItemRow(e={}){var t=document.importNode(itemTemplate.content,!0);let r=t.querySelector(".item-row");return e.id&&(r.dataset.itemId=e.id),e.item_name&&(t.querySelector(".item-name").value=e.item_name),e.quantity&&(t.querySelector(".item-quantity").value=e.quantity),e.station&&(t.querySelector(".item-station").value=e.station),e.preparation_time_minutes&&(t.querySelector(".item-prep-time").value=e.preparation_time_minutes),e.item_status&&(t.querySelector(".item-status").value=e.item_status),t.querySelector(".btn-remove-item").addEventListener("click",function(){r.remove()}),itemsList.appendChild(t),r}function resetForm(){customerNameInput.value="",orderSourceSelect.value="",scheduledTimeInput.value="",itemsList.innerHTML="",currentOrderId=null,addItemRow()}async function loadPendingOrders(){try{pendingOrdersList.innerHTML='<div class="loading">Loading orders...</div>';var e=await fetch("http://localhost:3000/orders?status=pending,in_progress");if(!e.ok)throw new Error("Failed to fetch pending orders");var r=(await e.json()).filter(e=>"pending"===e.status||"in_progress"===e.status);if(r.sort((e,t)=>e.scheduled_at||t.scheduled_at?e.scheduled_at?t.scheduled_at?new Date(e.scheduled_at)-new Date(t.scheduled_at):1:-1:0),pendingOrdersList.innerHTML="",0===r.length)pendingOrdersList.innerHTML='<div class="empty-message">No pending orders</div>';else{let t=document.createElement("div");t.className="pending-orders-container",r.forEach(e=>{e=createOrderCard(e);t.appendChild(e)}),pendingOrdersList.appendChild(t)}}catch(e){showNotification("Error loading orders: "+e.message,"error"),pendingOrdersList.innerHTML='<div class="error-message">Failed to load orders</div>'}}async function loadCompletedOrders(){try{completedOrdersList.innerHTML='<div class="loading">Loading orders...</div>';let e=0;for(;e<3;){e++;var t=await fetch("http://localhost:3000/orders?status=done");if(!t.ok)throw new Error("Failed to fetch completed orders");var r=(await t.json()).filter(e=>"done"===e.status);if(0<r.length)return void displayCompletedOrders(r);e<3&&await new Promise(e=>setTimeout(e,500))}var o=await fetch("http://localhost:3000/orders");if(!o.ok)throw new Error("Failed to fetch all orders");displayCompletedOrders((await o.json()).filter(e=>"done"===e.status))}catch(e){showNotification("Error loading orders: "+e.message,"error"),completedOrdersList.innerHTML='<div class="error-message">Failed to load orders</div>'}}function displayCompletedOrders(e){if(completedOrdersList.innerHTML="",0===e.length)completedOrdersList.innerHTML='<div class="empty-message">No completed orders</div>';else{e.sort((e,t)=>e.scheduled_at||t.scheduled_at?e.scheduled_at?t.scheduled_at?new Date(e.scheduled_at)-new Date(t.scheduled_at):1:-1:0);let t=document.createElement("div");t.className="completed-orders-container",e.forEach(e=>{e=createOrderCard(e);t.appendChild(e)}),completedOrdersList.appendChild(t)}}function createOrderCard(d){var e=document.importNode(orderCardTemplate.content,!0).querySelector(".order-card"),t=(e.dataset.orderId=d.id,document.createElement("div")),r=(t.className="order-time",d.scheduled_at?(r=new Date(d.scheduled_at),t.textContent=r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})):t.textContent="ASAP",e.insertBefore(t,e.firstChild),e.querySelector(".order-id").textContent="",e.querySelector(".customer-name").textContent=d.customer,e.querySelector(".order-source").textContent=` (${d.source})`,e.querySelector(".order-items-list")),t=(d.items&&0<d.items.length?(t=d.items.map(e=>`<div class="order-item">
            <span class="item-quantity">${e.quantity}x</span>
            <span class="item-name">${e.item_name}</span>
            <span class="item-station">${e.station}</span>
            <span class="item-status ${e.item_status}">${e.item_status}</span>
          </div>`).join(""),r.innerHTML=t):r.innerHTML='<div class="empty-items">No items</div>',e.addEventListener("click",function(e){e.target.closest("button")||this.classList.toggle("expanded")}),e.querySelector(".btn-edit").addEventListener("click",e=>{e.stopPropagation(),loadOrderForEdit(d.id)}),e.querySelector(".btn-complete"));return"done"===d.status?t.style.display="none":t.addEventListener("click",async e=>{e.stopPropagation();try{var t={id:d.id,status:"done"},r=await fetch("http://localhost:3000/orders/"+d.id);if(!r.ok)throw new Error("Failed to fetch the latest order data");var o=await r.json();if(!(await fetch("http://localhost:3000/orders/"+d.id,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:t,items:o.items||[]})})).ok)throw new Error("Failed to mark order as complete");showNotification("Order marked as complete","success"),loadPendingOrders(),document.querySelector('[data-tab="completed-orders"]').click(),setTimeout(()=>{loadCompletedOrders()},1e3)}catch(e){showNotification("Error: "+e.message,"error")}}),e.querySelector(".btn-delete").addEventListener("click",async e=>{if(e.stopPropagation(),confirm("Are you sure you want to delete this order?"))try{if(!(await fetch("http://localhost:3000/orders/"+d.id,{method:"DELETE"})).ok)throw new Error("Failed to delete order");showNotification("Order deleted successfully","success"),loadPendingOrders(),loadCompletedOrders()}catch(e){showNotification("Error: "+e.message,"error")}}),e}async function loadOrderForEdit(e){try{var t=await fetch("http://localhost:3000/orders/"+e);if(!t.ok)throw new Error("Failed to fetch order details");var r=await t.json();customerNameInput.value=r.customer||"",orderSourceSelect.value=r.source||"",scheduledTimeInput.value=r.scheduled_at?formatDateTimeLocal(new Date(r.scheduled_at)):"",itemsList.innerHTML="",r.items&&0<r.items.length?r.items.forEach(e=>addItemRow(e)):addItemRow(),currentOrderId=r.id,document.querySelector('[data-tab="create-order"]').click()}catch(e){showNotification("Error loading order: "+e.message,"error")}}function formatDateTimeLocal(e){return e.getFullYear()+`-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}T${e.getHours().toString().padStart(2,"0")}:`+e.getMinutes().toString().padStart(2,"0")}function showNotification(e,t){let r=document.createElement("div");r.className="notification notification-"+t,r.textContent=e,document.body.appendChild(r),setTimeout(()=>{r.remove()},3e3)}updateClock(),setInterval(updateClock,1e3),navTabs.forEach(e=>{e.addEventListener("click",function(){navTabs.forEach(e=>e.classList.remove("active")),tabContents.forEach(e=>e.classList.remove("active")),this.classList.add("active");var e=this.getAttribute("data-tab");document.getElementById(e).classList.add("active"),"pending-orders"===e?loadPendingOrders():"completed-orders"===e&&loadCompletedOrders()})}),addItemButton.addEventListener("click",function(){addItemRow()}),cancelOrderButton.addEventListener("click",function(){resetForm(),currentOrderId&&(currentOrderId=null,document.querySelector('[data-tab="pending-orders"]').click())}),orderForm.addEventListener("submit",async function(e){e.preventDefault();try{var t={customer:customerNameInput.value,source:orderSourceSelect.value,status:"pending",scheduled_at:scheduledTimeInput.value||null};let r=[];var d=itemsList.querySelectorAll(".item-row");let o=!1;if(d.forEach(e=>{var t=e.querySelector(".item-name").value;t.trim()&&(o=!0,t={item_name:t,quantity:parseInt(e.querySelector(".item-quantity").value)||1,station:e.querySelector(".item-station").value,preparation_time_minutes:parseInt(e.querySelector(".item-prep-time").value)||5,item_status:e.querySelector(".item-status").value||"pending"},e.dataset.itemId&&(t.id=e.dataset.itemId),r.push(t))}),o){var a,n=!!currentOrderId,i=n?"http://localhost:3000/orders/"+currentOrderId:"http://localhost:3000/orders",s=await fetch(i,{method:n?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:t,items:r})});if(!s.ok)throw a=await s.json(),new Error(a.error||"Failed to save order");await s.json();showNotification(n?"Order updated successfully":"Order created successfully","success"),resetForm(),document.querySelector('[data-tab="pending-orders"]').click()}else showNotification("Please add at least one item with a name","error")}catch(e){showNotification("Error: "+e.message,"error")}}),document.addEventListener("DOMContentLoaded",()=>{addItemRow(),loadPendingOrders()})</script></body></html>